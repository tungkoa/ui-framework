{"code":"import { Component } from '../component.js';\nimport { isSSR, strToHash } from '../core.js';\nexport class Suspense extends Component {\n    ready = false;\n    constructor(props) {\n        super(props);\n        // get props promises in ...rest\n        const { children, fallback, cache = false, ...rest } = this.props;\n        // stringify ...rest\n        const str = JSON.stringify(rest, function (_key, val) {\n            if (typeof val === 'function')\n                return `${val}`; // implicitly `toString` it\n            return val;\n        });\n        // create unique id based on ...rest\n        this.id = strToHash(JSON.stringify(str));\n    }\n    async didMount() {\n        // get props promises in ...rest\n        const { children, fallback, cache = false, ...rest } = this.props;\n        // set initial state to []\n        if (cache)\n            this.initState = {};\n        // check if we already cached the results in this.state\n        if (this.loadFromCache(cache))\n            return;\n        // resolve the promises\n        const promises = Object.values(rest).map(p => p());\n        const resolved = await Promise.all(promises);\n        // prepare data\n        const data = this.prepareData(rest, resolved, cache);\n        // add data to children\n        this.addDataToChildren(data);\n        // update the component\n        this.ready = true;\n        this.update();\n    }\n    ssr() {\n        // get props promises in ...rest\n        const { children, fallback, cache = false, ...rest } = this.props;\n        // execute the functions\n        const functions = Object.values(rest).map(p => p());\n        // prepare data\n        const data = this.prepareData(rest, functions, false);\n        // add data to children\n        this.addDataToChildren(data);\n    }\n    loadFromCache(cache) {\n        const hasCachedProps = this.state && cache && Object.keys(this.state).length > 0;\n        if (hasCachedProps) {\n            this.addDataToChildren(this.state);\n            this.ready = true;\n        }\n        return hasCachedProps;\n    }\n    prepareData(rest, fnc, cache) {\n        const data = Object.keys(rest).reduce((obj, item, index) => {\n            if (cache)\n                this.state = { ...this.state, [item]: fnc[index] };\n            return {\n                ...obj,\n                [item]: fnc[index]\n            };\n        }, {});\n        return data;\n    }\n    addDataToChildren(data) {\n        // add data as props to children\n        this.props.children.forEach((child) => {\n            if (child.props)\n                child.props = { ...child.props, ...data };\n        });\n    }\n    render() {\n        if (!isSSR()) {\n            const { cache = false } = this.props;\n            this.loadFromCache(cache);\n            return !this.ready ? this.props.fallback : this.props.children;\n        }\n        else {\n            this.ssr();\n            return this.props.children;\n        }\n    }\n}\n//# sourceMappingURL=suspense.js.map","references":["/Users/tungkoa/WebstormProjects/new-ui-framework/nano/src/component.ts","/Users/tungkoa/WebstormProjects/new-ui-framework/nano/src/core.ts"],"map":"{\"version\":3,\"file\":\"suspense.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/components/suspense.ts\"],\"names\":[],\"mappings\":\"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\"}","dtsmap":{"name":"./node_modules/.cache/.rts2_cache_es/placeholder/components/suspense.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"suspense.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/components/suspense.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,iBAAiB,CAAA;AAG3C,UAAU,KAAK;IACb,QAAQ,EAAE,GAAG,CAAA;IACb,KAAK,CAAC,EAAE,OAAO,CAAA;IACf,CAAC,GAAG,EAAE,MAAM,GAAG,GAAG,CAAA;CACnB;AAED,qBAAa,QAAS,SAAQ,SAAS,CAAC,KAAK,CAAC;IAC5C,KAAK,UAAQ;gBAED,KAAK,EAAE,KAAK;IAgBlB,QAAQ;IAyBd,GAAG;IAcH,aAAa,CAAC,KAAK,EAAE,OAAO;IAW5B,WAAW,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,QAAQ,EAAE,EAAE,KAAK,EAAE,OAAO;IAWtD,iBAAiB,CAAC,IAAI,EAAE,GAAG;IAO3B,MAAM;CAUP\"}"},"dts":{"name":"./node_modules/.cache/.rts2_cache_es/placeholder/components/suspense.d.ts","writeByteOrderMark":false,"text":"import { Component } from '../component.js';\ninterface Props {\n    fallback: any;\n    cache?: boolean;\n    [key: string]: any;\n}\nexport declare class Suspense extends Component<Props> {\n    ready: boolean;\n    constructor(props: Props);\n    didMount(): Promise<void>;\n    ssr(): void;\n    loadFromCache(cache: boolean): any;\n    prepareData(rest: any, fnc: Function[], cache: boolean): {};\n    addDataToChildren(data: any): void;\n    render(): any;\n}\nexport {};\n//# sourceMappingURL=suspense.d.ts.map"}}
